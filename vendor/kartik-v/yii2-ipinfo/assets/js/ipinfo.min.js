/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015 - 2016
 * @version 1.0.0
 *
 * Krajee IP Information fetcher plugin using PHP API from freegeoip.net. The plugin is built to work with
 * `kartik-v/yii2-ipinfo` extension. The plugin refreshes IP information via AJAX on document load.
 *
 * @see http://api.freegeoip.net
 *
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(t){"use strict";var e=function(e,n){var a=this;a.$element=t(e),a.init(n)};e.prototype={constructor:e,init:function(e){var n=this,a=n.$element;t.each(e,function(t,e){n[t]=e}),t.ajax({url:n.url,type:"GET",dataType:"json",data:n.params,beforeSend:function(t){a.trigger("beforesend.kvipinfo",[t])},success:function(e,r,o){var i,s,f,l=e,p="",c=l.country_code;a.trigger("success.kvipinfo",[e,r,o]),l&&c?(n.flagWrapper&&(s=t.isEmptyObject(n.flagOptions)?{}:n.flagOptions,f="flag-icon-"+c.toLowerCase(),i=t(document.createElement("span")).attr(s).removeClass(f).addClass(f),t("#"+n.flagWrapper).html("").append(i)),t.each(n.fields,function(t,e){void 0!==l[e]&&(p+="<tr><th>"+n.defaultFields[e]+"</th><td>"+l[e]+"</td></tr>\n",n.setContent("p",e,l[e]),n.setContent("i",e,l[e]))}),p&&(n.setContent("p","table",p),n.setContent("i","table",p)),a.html(a.find(".kv-hide").html()),a.text().length||a.html(n.noData)):a.html(n.noData)},error:function(t,e,r){a.trigger("error.kvipinfo",[t,e,r]).html(n.errorData)}})},setContent:function(e,n,a){var r=this,o=r.$element.attr("id"),i="table"===n?"table.":"#",s=t(i+o+"-"+n+"-"+e);s.length&&(a.length?s.html(a):s.remove())}},t.fn.kvIpInfo=function(n){var a=Array.apply(null,arguments);return a.shift(),this.each(function(){var r,o=t(this),i=o.data("kvIpInfo"),s="object"==typeof n&&n;i||(r=t.extend({},t.fn.kvIpInfo.defaults),i=new e(this,t.extend(r,s,o.data())),o.data("kvIpInfo",i)),"string"==typeof n&&i[n].apply(i,a)})},t.fn.kvIpInfo.defaults={flagWrapper:"",flagOptions:{},fields:[],defaultFields:{},url:"",params:{},noData:"",errorData:""},t.fn.kvIpInfo.Constructor=e}(window.jQuery);